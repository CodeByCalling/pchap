rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Applicants folder:
    // - Users can upload files to their own folder
    // - Users can read their own files
    // - Admins can read all files
    match /applicants/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
    }

    function isAdmin() {
      return request.auth.token.email.matches('.*admin.*');
    }

    // Contribution receipts:
    // - Members can upload receipts to their own folder
    // - Members can read their own receipts
    // - Admins can read all receipts
    match /contributions/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
    }
  }
}
